<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AWE-AgentForge monitor</title>
  
  <link rel="stylesheet" href="/web/assets/dashboard.css" />
</head>
<body>
  <div class="shell">
    <section class="header">
      <div class="header-main">
        <div>
          <h1 class="heading">AWE-AgentForge | Multi-CLI Monitor</h1>
          <p class="hint">Left: projects and participant roles. Right: agent conversation stream and controls.</p>
        </div>
        <div class="toolbar">
          <button id="refreshBtn">Refresh All</button>
          <button id="pollBtn">Background Refresh: OFF</button>
          <div class="theme-wrap">
            <span class="theme-label">Theme</span>
            <select id="themeSelect" class="theme-select" aria-label="Dashboard theme"></select>
          </div>
          <span id="connBadge" class="pill">API: CHECKING</span>
        </div>
      </div>
      <div id="statsLine" class="mini-status">Loading stats...</div>
      <div id="kpiStrip" class="kpi-strip"></div>
    </section>

    <main class="layout">
      <aside class="left-col">
        <section class="card">
          <div class="tree-head">
            <h2 class="card-title">Project Structure</h2>
            <div class="tree-tools">
              <button id="expandTreeBtn" class="tree-tool-btn" type="button">Expand</button>
              <button id="collapseTreeBtn" class="tree-tool-btn" type="button">Collapse</button>
            </div>
          </div>
          <div id="projectTreeMeta" class="mini-status"></div>
          <div id="projectTree" class="list tree-list"></div>
        </section>

        <section class="card">
          <h2 class="card-title">Roles / Sessions</h2>
          <div id="roleList" class="list"></div>
        </section>
      </aside>

      <section class="right-col">
        <section class="card controls">
          <h2 class="card-title">Dialogue Scope</h2>
          <div class="controls-row">
            <div style="flex:1; min-width:220px;">
              <label for="projectSelect">Project</label>
              <select id="projectSelect"></select>
            </div>
            <div style="flex:2; min-width:240px;">
              <label for="taskSelect">Task</label>
              <select id="taskSelect"></select>
            </div>
            <div style="flex:1; min-width:150px;">
              <label for="forceReason">Force-fail reason</label>
              <input id="forceReason" value="watchdog_timeout: operator forced fail" />
            </div>
          </div>
          <div class="controls-row">
            <button id="startBtn" class="btn-main">Start</button>
            <button id="approveQueueBtn" class="btn-main">Approve + Queue</button>
            <button id="approveStartBtn" class="btn-main">Approve + Start</button>
            <button id="rejectBtn" class="btn-warn">Reject</button>
            <button id="customReplyBtn" class="btn-main">Custom Reply + Re-run</button>
            <button id="cancelBtn" class="btn-warn">Cancel</button>
            <button id="forceFailBtn">Force Fail</button>
            <input id="promoteRound" type="number" min="1" value="1" style="width:96px;" />
            <button id="promoteRoundBtn" class="btn-main">Promote Round</button>
            <button id="reloadEventsBtn">Reload Conversation Only</button>
            <button id="streamDetailBtn">Stream Details: OFF</button>
          </div>
          <div class="controls-row">
            <div style="flex:1; min-width:260px;">
              <label for="manualReplyNote">Manual reply for reviewer/author (used by Custom Reply + Re-run)</label>
              <textarea id="manualReplyNote" placeholder="Type special constraints, business intent, scope changes, or acceptance criteria..."></textarea>
            </div>
          </div>
          <div id="actionStatus" class="mini-status"></div>
          <div id="taskSnapshot" class="status-grid"></div>
        </section>

        <section class="card">
          <h2 class="card-title">Conversation</h2>
          <div id="dialogue" class="dialogue"></div>
        </section>

        <section class="card">
          <div class="tree-head">
            <h2 class="card-title">Project History</h2>
            <div class="tree-tools">
              <button id="clearHistoryBtn" class="tree-tool-btn btn-warn" type="button">Clear</button>
              <button id="toggleHistoryBtn" class="tree-tool-btn" type="button">Collapse</button>
            </div>
          </div>
          <div id="projectHistoryBody" class="history-body">
            <div id="historySummary" class="mini-status"></div>
            <div id="projectHistory" class="history-list"></div>
          </div>
        </section>

        <section class="card">
          <div class="tree-head">
            <h2 class="card-title">Advanced Analytics</h2>
          </div>
          <div id="analyticsSummary" class="history-list"></div>
        </section>

        <section class="card">
          <div class="tree-head">
            <h2 class="card-title">GitHub / PR Summary</h2>
            <div class="tree-tools">
              <button id="reloadGithubSummaryBtn" class="tree-tool-btn" type="button">Reload</button>
            </div>
          </div>
          <div id="githubSummaryMeta" class="mini-status">Select a task to generate PR-ready summary.</div>
          <textarea id="githubSummaryText" readonly style="min-height: 220px;"></textarea>
        </section>

        <section class="card">
          <div class="tree-head">
            <h2 class="card-title">Create Task</h2>
            <div class="tree-tools">
              <button id="openCreateHelpBtn" class="tree-tool-btn" type="button">Help</button>
            </div>
          </div>
          <div id="createHelpPanel" class="create-help is-collapsed">
            <div class="create-help-head">
              <div id="createHelpHint" class="mini-status">Create Task field guide</div>
              <div class="tree-tools">
                <button id="createHelpLangEnBtn" class="tree-tool-btn" type="button">EN</button>
                <button id="createHelpLangZhBtn" class="tree-tool-btn" type="button">中文</button>
                <button id="closeCreateHelpBtn" class="tree-tool-btn" type="button">Close</button>
              </div>
            </div>
            <div id="createHelpList" class="create-help-list"></div>
          </div>
          <div class="controls-row">
            <div style="flex:1; min-width:220px;">
              <label for="title">Title</label>
              <input id="title" value="Improve monitor signal quality" />
            </div>
            <div style="flex:1; min-width:220px;">
              <label for="workspacePath">Workspace path</label>
              <input id="workspacePath" value="C:/Users/hangw/awe-agentcheck" />
            </div>
          </div>
          <div class="controls-row">
            <input id="author" value="codex#author-A" type="hidden" />
            <input id="reviewers" value="claude#review-B,gemini#review-C" type="hidden" />
          </div>
          <div class="controls-row">
            <div style="flex:1; min-width:520px;">
              <label for="participantCapabilityMatrix">Bot Capability Matrix (per role, optional)</label>
              <div class="participant-matrix-tools">
                <button id="matrixAddReviewerBtn" type="button">+ Add Reviewer</button>
              </div>
              <div id="participantCapabilityMatrix" class="participant-matrix"></div>
              <div class="mini-status">Manage author/reviewers here. Per-role overrides win over provider defaults above.</div>
            </div>
          </div>
          <div class="controls-row">
            <div style="flex:1; min-width:220px;">
              <label for="policyTemplate">Policy Template</label>
              <select id="policyTemplate"></select>
            </div>
            <div style="flex:1; min-width:220px;">
              <label>&nbsp;</label>
              <button id="applyPolicyTemplateBtn" type="button">Apply Policy</button>
            </div>
            <div style="flex:2; min-width:260px;">
              <label for="policyProfileHint">Workspace Profile</label>
              <input id="policyProfileHint" readonly value="Loading policy profile..." />
            </div>
          </div>
          <div class="controls-row">
            <div style="flex:1; min-width:220px;">
              <label for="claudeModel">Claude Model</label>
              <select id="claudeModel"></select>
              <input id="claudeModelCustom" value="" placeholder="optional custom model override" />
            </div>
            <div style="flex:1; min-width:220px;">
              <label for="codexModel">Codex Model</label>
              <select id="codexModel"></select>
              <input id="codexModelCustom" value="" placeholder="optional custom model override" />
            </div>
            <div style="flex:1; min-width:220px;">
              <label for="geminiModel">Gemini Model</label>
              <select id="geminiModel"></select>
              <input id="geminiModelCustom" value="" placeholder="optional custom model override" />
            </div>
          </div>
          <div class="controls-row">
            <div style="flex:1; min-width:220px;">
              <label for="claudeModelParams">Claude Model Params (optional)</label>
              <input id="claudeModelParams" value="" placeholder="e.g. --temperature 0.2" />
            </div>
            <div style="flex:1; min-width:220px;">
              <label for="codexModelParams">Codex Model Params (optional)</label>
              <input id="codexModelParams" value="-c model_reasoning_effort=xhigh" placeholder="-c model_reasoning_effort=xhigh" />
            </div>
            <div style="flex:1; min-width:220px;">
              <label for="geminiModelParams">Gemini Model Params (optional)</label>
              <input id="geminiModelParams" value="--approval-mode yolo" placeholder="--approval-mode yolo" />
            </div>
          </div>
          <div class="controls-row">
            <div style="flex:1; min-width:160px;">
              <label for="evolutionLevel">Evolution Level</label>
              <select id="evolutionLevel">
                <option value="0">0 | fix-only</option>
                <option value="1">1 | guided evolve</option>
                <option value="2">2 | proactive evolve</option>
              </select>
            </div>
            <div style="flex:0 0 220px;">
              <label for="repairMode">Repair Mode</label>
              <select id="repairMode">
                <option value="minimal">minimal | smallest safe patch</option>
                <option value="balanced" selected>balanced | root-cause + focused scope</option>
                <option value="structural">structural | allow deeper refactor</option>
              </select>
            </div>
            <div style="flex:0 0 180px;">
              <label for="maxRounds">Max Rounds (fallback)</label>
              <input id="maxRounds" type="number" min="1" max="20" value="1" />
            </div>
            <div style="flex:1; min-width:220px;">
              <label for="evolveUntil">Evolve Until (optional)</label>
              <input id="evolveUntil" value="" placeholder="2026-02-13 06:00" />
            </div>
            <div style="flex:0 0 220px;">
              <label for="conversationLanguage">Conversation Language</label>
              <select id="conversationLanguage">
                <option value="en">English (default)</option>
                <option value="zh">中文</option>
              </select>
            </div>
            <div style="flex:0 0 220px;">
              <label for="plainMode">Plain Mode</label>
              <select id="plainMode">
                <option value="1">1 | beginner-friendly (default)</option>
                <option value="0">0 | raw technical output</option>
              </select>
            </div>
            <div style="flex:0 0 220px;">
              <label for="streamMode">Stream Mode</label>
              <select id="streamMode">
                <option value="1">1 | realtime stream (default)</option>
                <option value="0">0 | stage summary only</option>
              </select>
            </div>
            <div style="flex:0 0 220px;">
              <label for="debateMode">Debate Mode</label>
              <select id="debateMode">
                <option value="1">1 | reviewer-author debate (default)</option>
                <option value="0">0 | skip debate</option>
              </select>
            </div>
          </div>
          <div class="controls-row">
            <div style="flex:0 0 220px;">
              <label for="sandboxMode">Sandbox Mode</label>
              <select id="sandboxMode">
                <option value="1">1 | lab sandbox (default)</option>
                <option value="0">0 | direct main workspace</option>
              </select>
            </div>
            <div style="flex:1; min-width:220px;">
              <label for="sandboxWorkspacePath">Sandbox Workspace Path (optional)</label>
              <input id="sandboxWorkspacePath" value="" placeholder="leave blank for unique per-task sandbox under <workspace>-lab" />
            </div>
          </div>
          <div class="controls-row">
            <div style="flex:0 0 220px;">
              <label for="selfLoopMode">Self Loop Mode</label>
              <select id="selfLoopMode">
                <option value="0">0 | discuss then ask author (default)</option>
                <option value="1">1 | autonomous execute</option>
              </select>
            </div>
            <div style="flex:0 0 220px;">
              <label for="autoMerge">Auto Merge</label>
              <select id="autoMerge">
                <option value="1">1 | enabled (default)</option>
                <option value="0">0 | disabled</option>
              </select>
            </div>
            <div style="flex:1; min-width:220px;">
              <label for="mergeTargetPath">Merge Target Path (optional)</label>
              <input id="mergeTargetPath" value="C:/Users/hangw/awe-agentcheck" placeholder="leave blank to merge in-place" />
            </div>
          </div>
          <div class="controls-row">
            <div style="flex:1; min-width:220px;">
              <label for="description">Description</label>
              <textarea id="description">Discuss, implement, review, and verify with medium gate.</textarea>
            </div>
          </div>
          <div class="controls-row">
            <button id="createBtn" class="btn-main">Create</button>
            <button id="createAndStartBtn">Create + Start</button>
          </div>
          <div id="createStatus" class="mini-status"></div>
        </section>
      </section>
    </main>
  </div>

  
    <script type="module" src="/web/assets/dashboard.js"></script>
  </body>
</html>

